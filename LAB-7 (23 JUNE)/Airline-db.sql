CREATE DATABASE AIRLINES;
USE AIRLINES;
CREATE TABLE FLIGHTS(
 FLNO INT,
 `FROM` VARCHAR(20),
 `TO` VARCHAR(20),
 DISTANCE INT,
DEPARTS TIME,
 ARRIVES TIME,
PRICE INT,
 PRIMARY KEY(FLNO) );
 CREATE TABLE AIRCRAFT(
 AID INT,
 ANAME VARCHAR(20),
 CRUISINGRANGE INT,
  PRIMARY KEY (AID) );

CREATE TABLE EMPLOYEES(
 EID INT,
 ENAME VARCHAR(20),
 SALARY INT,
 PRIMARY KEY (EID) );

CREATE TABLE CERTIFIED(
  EID INT,
  AID INT,
  PRIMARY KEY (EID,AID),
 FOREIGN KEY (EID) REFERENCES EMPLOYEES (EID),     
FOREIGN KEY (AID) REFERENCES AIRCRAFT (AID) );

INSERT INTO FLIGHTS (FLNO,`FROM`,`TO`,DISTANCE,DEPARTS,ARRIVES,PRICE) VALUES 
 (1,'BANGALORE','CHENNAI',360,'08:45','10:00',10000),
 (2,'BANGALORE','DELHI',1700,'12:15','15:00',37000),
 (3,'BANGALORE','KOLKATA',1500,'15:15','05:25',30000),
 (4,'MUMBAI','DELHI',1200,'10:30','12:30',28000),
(5,'BANGALORE','NEW YORK',14000,'05:45','02:30',90000),
(6,'DELHI','CHICAGO',12000,'10:00','05:45',95000),
(7,'BANGALORE','FRANKFURT',15000,'12:00','06:30',98000), 
 (8,'MADISON','NEW YORK',1500,'10:15','14:25',30000);

INSERT INTO AIRCRAFT (AID,ANAME,CRUISINGRANGE) VALUES 
        (1,'AIRBUS 380',1000),
        (2,'BOEING 737',4000),
        (3,'LOCKHEED',5500),
        (4,'AIRBUS A220',9500), 
        (5,'BOEING 747',800),
        (6,'DOUGLAS DC3',900);

INSERT INTO EMPLOYEES (EID,ENAME,SALARY) VALUES
(1,'ZOYA',95000),
(2,'AKSHAY',65000),
(3,'NIVEDITHA',70000),
(4,'SAFAN',45000),
(5,'PETER',95000),
 (6,'NAYAN',100000), 
(7,'AJAY',50000);

INSERT INTO CERTIFIED (EID,AID) VALUES
(1,1),
(1,3),
(1,4),
(5,4),
(5,3),
(1,2),
 (2,6),
(2,5),
(4,5),
 (6,4),
 (6,3),
 (3,6),
 (3,2);

/* I. FOR EACH PILOT WHO IS CERTIFIED FOR MORE THAN THREE AIRCRAFTS, FIND THE EID AND THE MAXIMUM CRUISING RANGE OF
THE AIRCRAFT FOR WHICH SHE OR HE IS CERTIFIED*/
SELECT DISTINCT A.ANAME
FROM AIRCRAFT A
WHERE A.AID IN (SELECT C.AID
FROM CERTIFIED C, EMPLOYEES E
WHERE C.EID = E.EID AND
NOT EXISTS ( SELECT *
FROM EMPLOYEES E1
WHERE E1.EID = E.EID AND E1.SALARY < 80000 )) ;

/* II. FIND THE NAMES OF PILOTS WHOSE SALARY IS LESS THAN THE PRICE OF THE CHEAPEST ROUTE FROM BENGALURU TO
FRANKFURT.*/
SELECT C.EID, MAX(A.CRUISINGRANGE)
FROM CERTIFIED C, AIRCRAFT A
WHERE C.AID = A.AID
GROUP BY C.EID
HAVING COUNT(*) > 3;


/* III. FOR ALL AIRCRAFT WITH CRUISING RANGE OVER 1000 KMS, FIND THE NAME OF THE AIRCRAFT AND THE AVERAGE SALARY OF
ALL PILOTS CERTIFIED FOR THIS AIRCRAFT.*/
SELECT DISTINCT E.ENAME
     FROM EMPLOYEES E
    WHERE E.SALARY<
    (SELECT MIN(F.PRICE)
    FROM FLIGHTS F
    WHERE F.FROM='BANGALORE'
    AND F.TO='FRANKFURT');


/* IV. FIND THE NAMES OF PILOTS CERTIFIED FOR SOME BOEING AIRCRAFT.*/
SELECT A.AID,A.ANAME,AVG(E.SALARY)
     FROM AIRCRAFT A,CERTIFIED C,EMPLOYEES E
    WHERE A.AID=C.AID
    AND C.EID=E.EID
    AND A.CRUISINGRANGE>1000
    GROUP BY A.AID,A.ANAME;
   
/* V. FIND THE AIDS OF ALL AIRCRAFT THAT CAN BE USED ON ROUTES FROM BENGALURU TO NEW DELHI.*/
SELECT DISTINCT E.ENAME
     FROM EMPLOYEES E,AIRCRAFT A,CERTIFIED C
    WHERE E.EID=C.EID
    AND C.AID=A.AID
   AND A.ANAME LIKE 'BOEING%';

/*VI. A CUSTOMER WANTS TO TRAVEL FROM MADISON TO NEW YORK WITH NO MORE THAN TWO CHANGES OF FLIGHT. LIST THE
CHOICE OF DEPARTURE TIMES FROM MADISON IF THE CUSTOMER WANTS TO ARRIVE IN NEW YORK BY 6 P.M.
*/
 SELECT A.AID
     FROM AIRCRAFT A
     WHERE A.CRUISINGRANGE>
     (SELECT MIN(F.DISTANCE)
    FROM FLIGHTS F
    WHERE F.FROM='BANGALORE'
    AND F.TO='DELHI');

/* VII. A CUSTOMER WANTS TO TRAVEL FROM MADISON TO NEW YORK WITH NO MORE THAN TWO CHANGES OF FLIGHT. LIST THE
CHOICE OF DEPARTURE TIMES FROM MADISON IF THE CUSTOMER WANTS TO ARRIVE IN NEW YORK BY 6 P.M.*/
SELECT F.DEPARTS
FROM FLIGHTS F WHERE F.FLNO IN (  SELECT F0.FLNO
FROM FLIGHTS F0
WHERE F0.FROM = 'MADISON' AND F0.TO = 'NEW YORK' AND F0.ARRIVES < '18:00' );

/* VIII. PRINT THE NAME AND SALARY OF EVERY NON-PILOT WHOSE SALARY IS MORE THAN THE AVERAGE SALARY FOR PILOTS.
*/
SELECT E.ENAME, E.SALARY
FROM EMPLOYEES E
WHERE E.EID NOT IN ( SELECT DISTINCT C.EID
FROM CERTIFIED C )
AND E.SALARY > ( SELECT AVG (E1.SALARY)
FROM EMPLOYEES E1
WHERE E1.EID IN
( SELECT DISTINCT C1.EID
FROM CERTIFIED C1 ) );
 
